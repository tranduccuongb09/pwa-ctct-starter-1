<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kiá»ƒm tra CTÄ, CTCT - ÄÆ¡n vá»‹</title>
  <meta name="theme-color" content="#8B0000"/>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="style.css">
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js');
      });
    }
  </script>

  <!-- ====== CTCT ADAPTER: Náº P CÃ‚U Há»I Tá»ª GOOGLE SHEETS (CSV) ====== -->
  <script>
  /** ========== Cáº¤U HÃŒNH ========== **/
  // 1) DÃ¹ng Sheet máº«u (cháº¡y offline luÃ´n): data: URL CSV (cÃ³ 6 cÃ¢u vÃ­ dá»¥)
  const SAMPLE_CSV_DATA_URL =
    "data:text/csv;charset=utf-8," + encodeURIComponent(
`CÃ¢u há»i,ÄÃ¡p Ã¡n A,ÄÃ¡p Ã¡n B,ÄÃ¡p Ã¡n C,ÄÃ¡p Ã¡n D,ÄÃ¡p Ã¡n Ä‘Ãºng
"Chá»©c nÄƒng cÆ¡ báº£n cá»§a CTÄ, CTCT trong QÄNDVN lÃ  gÃ¬?","GiÃ¡o dá»¥c chÃ­nh trá»‹, tÆ° tÆ°á»Ÿng","CÃ´ng tÃ¡c dÃ¢n váº­n","Huáº¥n luyá»‡n ká»¹ thuáº­t","Háº­u cáº§n - ká»¹ thuáº­t","A"
"NguyÃªn táº¯c tá»• chá»©c cÆ¡ báº£n cá»§a QÄNDVN lÃ  gÃ¬?","Táº­p trung dÃ¢n chá»§","Tam quyá»n phÃ¢n láº­p","Táº­p quyá»n tuyá»‡t Ä‘á»‘i","PhÃ¢n tÃ¡n tá»± trá»‹","A"
"YÃªu cáº§u vá» ká»· luáº­t cá»§a quÃ¢n Ä‘á»™i?","Ká»· luáº­t nghiÃªm minh","Khoan dung, linh hoáº¡t","Tá»± do, sÃ¡ng táº¡o","Tuá»³ nghi, linh hoáº¡t","A"
"Ná»n táº£ng tÆ° tÆ°á»Ÿng, kim chá»‰ nam cá»§a ÄCSVN lÃ ?","Chá»§ nghÄ©a MÃ¡c - LÃªnin, TÆ° tÆ°á»Ÿng Há»“ ChÃ­ Minh","TÆ° tÆ°á»Ÿng Khá»•ng - Máº¡nh","Chá»§ nghÄ©a tá»± do","Chá»§ nghÄ©a dÃ¢n tÃºy","A"
"Äá»‘i tÆ°á»£ng giÃ¡o dá»¥c CTÄ, CTCT chá»§ yáº¿u trong Ä‘Æ¡n vá»‹ lÃ ?","CÃ¡n bá»™, chiáº¿n sÄ© trong Ä‘Æ¡n vá»‹","NhÃ¢n dÃ¢n Ä‘á»‹a phÆ°Æ¡ng","Doanh nghiá»‡p trÃªn Ä‘á»‹a bÃ n","Há»c sinh phá»• thÃ´ng","A"
"NguyÃªn táº¯c cÃ´ng tÃ¡c tÆ° tÆ°á»Ÿng lÃ ?","TÃ­nh Ä‘áº£ng, tÃ­nh khoa há»c, tÃ­nh chiáº¿n Ä‘áº¥u","Trung láº­p, má»m dáº»o","Tá»± phÃ¡t, linh hoáº¡t","Chá»§ quan, cáº£m tÃ­nh","A"
`);

  // 2) Khi cÃ³ Google Sheets tháº­t: THAY DÃ’NG DÆ¯á»šI Báº°NG LINK CSV PUBLISH
  window.CTCT_CONFIG = {
    // VÃ­ dá»¥ Ä‘á»‹nh dáº¡ng Ä‘Ãºng:
    // questionCsvUrl: "https://docs.google.com/spreadsheets/d/e/<ID>/pub?output=csv"
    questionCsvUrl: SAMPLE_CSV_DATA_URL
  };

  /** ========== ADAPTER: CSV â†’ DANH SÃCH CÃ‚U Há»I ========== **/
  (function () {
    function parseCSV(text){
      const rows=[]; let cur=''; let inQ=false; let row=[];
      for(let i=0;i<text.length;i++){
        const ch=text[i], next=text[i+1];
        if(ch==='\"'){ if(inQ && next==='\"'){cur+='\"'; i++;} else inQ=!inQ; }
        else if(ch===',' && !inQ){ row.push(cur); cur=''; }
        else if((ch==='\n'||ch==='\r') && !inQ){ if(cur!==''||row.length){row.push(cur); rows.push(row); row=[]; cur='';} }
        else { cur+=ch; }
      }
      if(cur!==''||row.length){row.push(cur); rows.push(row);}
      return rows.filter(r=>r.some(c=>c.trim()!==''));
    }

    function rowsToQuestions(rows){
      const header = rows[0].map(h=>h.trim().toLowerCase());
      const idx = {
        q: header.findIndex(h=>/cÃ¢u\s*há»i|question/.test(h)),
        a: header.findIndex(h=>/Ä‘Ã¡p\s*Ã¡n\s*a\b|^a$/.test(h)),
        b: header.findIndex(h=>/Ä‘Ã¡p\s*Ã¡n\s*b\b|^b$/.test(h)),
        c: header.findIndex(h=>/Ä‘Ã¡p\s*Ã¡n\s*c\b|^c$/.test(h)),
        d: header.findIndex(h=>/Ä‘Ã¡p\s*Ã¡n\s*d\b|^d$/.test(h)),
        correct: header.findIndex(h=>/Ä‘Ã¡p\s*Ã¡n\s*Ä‘Ãºng|correct|key/.test(h)),
      };
      const list=[];
      for(let i=1;i<rows.length;i++){
        const r=rows[i];
        const q={
          question: (r[idx.q]||'').trim(),
          options: {
            A: (r[idx.a]||'').trim(),
            B: (r[idx.b]||'').trim(),
            C: (r[idx.c]||'').trim(),
            D: (r[idx.d]||'').trim(),
          },
          answer: ((r[idx.correct]||'').trim().toUpperCase().match(/[ABCD]/)||['A'])[0]
        };
        if(q.question) list.push(q);
      }
      return list;
    }

    async function loadQuestionsFromSheet(){
      const url = window.CTCT_CONFIG?.questionCsvUrl;
      if(!url) throw new Error("Thiáº¿u CTCT_CONFIG.questionCsvUrl");
      const res = await fetch(url, {cache:"no-store"});
      if(!res.ok) throw new Error("KhÃ´ng táº£i Ä‘Æ°á»£c CSV tá»« Google Sheets");
      const text = await res.text();
      const rows = parseCSV(text);
      return rowsToQuestions(rows);
    }

    // Xuáº¥t global Ä‘á»ƒ trang/bá»™ pháº­n khÃ¡c dÃ¹ng
    window.loadQuestionsFromSheet = loadQuestionsFromSheet;

    // Táº£i sá»›m Ä‘á»ƒ dÃ¹ng ngay (vÃ­ dá»¥ cho quiz.html)
    window.QUESTIONS_DATA_PROMISE = loadQuestionsFromSheet().then(list => {
      window.QUESTIONS_DATA = list;
      return list;
    }).catch(err => {
      console.error("[CTCT] Lá»—i náº¡p cÃ¢u há»i:", err);
      window.QUESTIONS_DATA = [];
      return [];
    });
  })();
  </script>
  <!-- ====== /CTCT ADAPTER ====== -->
</head>

<body>
  <header class="hero">
    <div class="brand">
      <img src="icons/icon-192.png" alt="Logo" class="logo">
      <div>
        <h1>PHáº¦N Má»€M Há»ŒC Táº¬P & KIá»‚M TRA NHáº¬N THá»¨C CHÃNH TRá»Š</h1>
        <p class="subtitle">ÄÆ¡n vá»‹: <strong>BAN CHá»ˆ HUY PTKV3-TÃ‚N YÃŠN/Bá»˜ CHQS Tá»ˆNH Báº®C NINH</strong></p>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h2>Báº®T Äáº¦U</h2>
      <p>Chá»n chá»©c nÄƒng bÃªn dÆ°á»›i:</p>
      <div class="actions">
        <a class="btn" href="study.html">ğŸ“˜ Há»c táº­p</a>
        <a class="btn primary" href="quiz.html">ğŸ“ LÃ m bÃ i kiá»ƒm tra</a>
      </div>
    </section>

    <section class="card">
      <h3>Ghi chÃº</h3>
      <ul>
        <li>á»¨ng dá»¥ng cháº¡y trÃªn má»i thiáº¿t bá»‹ (Ä‘iá»‡n thoáº¡i, mÃ¡y tÃ­nh, iOS/Android).</li>
        <li>Nháº¥n â‹® (Chrome) &gt; <em>ThÃªm vÃ o MÃ n hÃ¬nh chÃ­nh</em> Ä‘á»ƒ cÃ i nhÆ° á»©ng dá»¥ng.</li>
      </ul>
    </section>

    <!-- (TÃ™Y CHá»ŒN) NÃºt test nhanh viá»‡c náº¡p cÃ¢u há»i tá»« Sheet máº«u -->
    <section class="card">
      <h3>Kiá»ƒm tra nhanh dá»¯ liá»‡u cÃ¢u há»i (Sheet máº«u)</h3>
      <button class="btn" id="btn-test-load">Táº£i & xem tá»•ng sá»‘ cÃ¢u</button>
      <div id="test-out" style="margin-top:8px;font-size:14px;color:#333"></div>
    </section>
  </main>

  <footer class="footer">Â© ÄÆ¡n vá»‹: Ban Chá»‰ huy PTKV3 - TÃ¢n YÃªn</footer>

  <script>
    // NÃºt test: hiá»ƒn thá»‹ nhanh sá»‘ cÃ¢u Ä‘Ã£ náº¡p tá»« Sheet máº«u/Google Sheets
    document.getElementById('btn-test-load')?.addEventListener('click', async () => {
      const list = await (window.QUESTIONS_DATA_PROMISE || window.loadQuestionsFromSheet());
      document.getElementById('test-out').textContent =
        `ÄÃ£ náº¡p ${list.length} cÃ¢u há»i. CÃ¢u 1: ${list[0]?.question || 'â€”'}`;
    });
  </script>
</body>
</html>
